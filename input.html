<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Input Harian</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

  <div class="container py-4" style="max-width:760px;">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="m-0">Input Harian</h3>
      <a href="index.html" class="btn btn-outline-secondary">Dashboard</a>
    </div>

    <div class="card shadow-sm">
      <div class="card-body">

        <div class="mb-3">
          <label class="form-label">Tanggal</label>
          <input id="date" type="date" class="form-control">
        </div>

        <div class="mb-3">
          <label class="form-label">Net Sales</label>
          <input id="netSales" type="number" class="form-control" placeholder="contoh: 5000000">
        </div>

        <div class="row g-3">
          <div class="col-md-3">
            <label class="form-label">APC</label>
            <input id="apc" type="number" class="form-control" value="0">
          </div>
          <div class="col-md-3">
            <label class="form-label">PSM</label>
            <input id="psm" type="number" class="form-control" value="0">
          </div>
          <div class="col-md-3">
            <label class="form-label">PWP</label>
            <input id="pwp" type="number" class="form-control" value="0">
          </div>
          <div class="col-md-3">
            <label class="form-label">SERBA GRATIS</label>
            <input id="serbaGratis" type="number" class="form-control" value="0">
          </div>
        </div>

        <button id="btnSave" class="btn btn-primary mt-4 w-100" onclick="save()">Simpan</button>
        <div id="msg" class="mt-3 small text-muted"></div>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDwAQ1huvii-IJC6LT17CzH-Q6AawGgpOw",
      authDomain: "numeric-nova-471404-c0.firebaseapp.com",
      projectId: "numeric-nova-471404-c0",
      storageBucket: "numeric-nova-471404-c0.firebasestorage.app",
      messagingSenderId: "175787187573",
      appId: "1:175787187573:web:ab48e4e3e259b60db0473c",
      measurementId: "G-KHCC6MPNZM"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    db.settings({ ignoreUndefinedProperties: true });

    function show(text){ document.getElementById("msg").textContent = text; }
    function lock(isLock){ document.getElementById("btnSave").disabled = isLock; }

    async function save(){
      const date = document.getElementById("date").value;
      const netSales = Number(document.getElementById("netSales").value || 0);

      const apc = Number(document.getElementById("apc").value || 0);
      const psm = Number(document.getElementById("psm").value || 0);
      const pwp = Number(document.getElementById("pwp").value || 0);
      const serbaGratis = Number(document.getElementById("serbaGratis").value || 0);

      if(!date) return show("❌ Tanggal wajib diisi");

      try{
        lock(true);
        show("Saving...");

        await db.collection("daily_sales").doc(date).set({
          date,
          netSales,
          updatedAt: Date.now()
        }, { merge:true });

        await db.collection("pps_daily").doc(date).set({
          date,
          APC: apc,
          PSM: psm,
          PWP: pwp,
          "SERBA GRATIS": serbaGratis,
          updatedAt: Date.now()
        }, { merge:true });

        show("✅ Berhasil disimpan");
      } catch(err){
        console.error("SAVE ERROR:", err);
        show("❌ Gagal simpan: " + (err?.message || err));
      } finally {
        lock(false);
      }
    }
  </script>

</body>
</html>
